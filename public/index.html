<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HACKATHON</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      background: #282a36;
      min-height: 100vh;
      font-family: 'JetBrains Mono', monospace;
      color: #cdd6f4;
      font-size: 14px;
      line-height: 1.6;
    }

    .window {
      max-width: 800px;
      margin: 0 auto;
      min-height: 100vh;
    }

    .titlebar {
      background: #3b3e52;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot.r { background: #ed8796; }
    .dot.y { background: #eed49f; }
    .dot.g { background: #a6da95; }

    .titlebar-text {
      color: #6e738d;
      font-size: 13px;
      margin: 0 auto;
    }

    .body {
      padding: 20px 24px 60px;
    }

    .output { margin-bottom: 16px; }
    .output:last-child { margin-bottom: 0; }

    /* User prompt line */
    .user-prompt {
      background: #363a4f;
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 12px;
      color: #cdd6f4;
      font-weight: 700;
    }
    .user-prompt .chevron {
      color: #eed49f;
      margin-right: 6px;
    }

    /* Bullet output lines (like Claude responses) */
    .bullet {
      padding-left: 20px;
      position: relative;
      margin-bottom: 6px;
    }
    .bullet::before {
      content: '●';
      position: absolute;
      left: 0;
      color: #eed49f;
      font-size: 10px;
      top: 3px;
    }

    /* Tool call blocks */
    .tool-block {
      padding-left: 20px;
      position: relative;
      margin-bottom: 8px;
    }
    .tool-block::before {
      content: '●';
      position: absolute;
      left: 0;
      color: #eed49f;
      font-size: 10px;
      top: 3px;
    }
    .tool-name { color: #cdd6f4; font-weight: 700; }
    .tool-output {
      padding-left: 20px;
      color: #939ab7;
      border-left: 1px solid #494d64;
      margin-top: 4px;
      margin-left: 2px;
    }
    .tool-output .pipe { color: #494d64; }

    .dim { color: #6e738d; }
    .green { color: #a6da95; }
    .red { color: #ed8796; }
    .yellow { color: #eed49f; }
    .blue { color: #8aadf4; }
    .mauve { color: #c6a0f6; }
    .bold { font-weight: 700; }
    .text { color: #cdd6f4; }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 14px;
      background: #cdd6f4;
      vertical-align: text-bottom;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }

    .line { display: none; }
    .line.visible { display: block; }

    /* The RSVP button — styled to look like an inline prompt action */
    .action-area {
      margin-top: 16px;
      display: none;
    }
    .action-area.visible { display: block; }

    .push-btn {
      background: #ed8796;
      color: #282a36;
      border: none;
      border-radius: 4px;
      padding: 8px 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s;
      margin-left: 20px;
    }
    .push-btn:hover { background: #ee99a0; }
    .push-btn:active { background: #eb7988; }

    /* Committed hackers as git log output */
    .hacker-log { margin-top: 16px; }
    .hacker-entry {
      padding-left: 20px;
      color: #939ab7;
    }
    .hacker-entry .hash {
      color: #eed49f;
    }
    .hacker-entry .name {
      color: #a6da95;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-overlay.open { display: flex; }

    .modal {
      background: #363a4f;
      border: 1px solid #494d64;
      border-radius: 8px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
    }

    .modal-label {
      color: #6e738d;
      font-size: 12px;
      margin-bottom: 8px;
    }

    .modal input {
      width: 100%;
      background: #282a36;
      border: 1px solid #494d64;
      border-radius: 4px;
      padding: 10px 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: #cdd6f4;
      outline: none;
      margin-bottom: 16px;
    }
    .modal input:focus { border-color: #c6a0f6; }
    .modal input::placeholder { color: #494d64; }

    .modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .modal-btn {
      background: #494d64;
      color: #cdd6f4;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s;
    }
    .modal-btn:hover { background: #5b6078; }
    .modal-btn.primary {
      background: #a6da95;
      color: #282a36;
    }
    .modal-btn.primary:hover { background: #b7e1a8; }
    .modal-btn:disabled {
      background: #363a4f;
      color: #6e738d;
      cursor: not-allowed;
    }

    @media (max-width: 600px) {
      html { font-size: 12px; }
      .body { padding: 16px; }
    }
  </style>
</head>
<body>

<div class="window">
  <div class="titlebar">
    <div class="dot r"></div>
    <div class="dot y"></div>
    <div class="dot g"></div>
    <span class="titlebar-text">hackathon — bash</span>
  </div>

  <div class="body" id="terminal">

    <!-- User prompt -->
    <div class="line" id="line0">
      <div class="user-prompt"><span class="chevron">❯</span>./invite.sh</div>
    </div>

    <div class="line" id="line1">
      <div class="output">
        <div class="tool-block">
          <span class="tool-name">Read(invite.sh)</span>
          <div class="tool-output">
            Loading hackathon details...
          </div>
        </div>
      </div>
    </div>

    <div class="line" id="line2">
      <div class="bullet"><span class="text">WHAT:  </span><span class="red bold">HACKATHON</span></div>
    </div>
    <div class="line" id="line3">
      <div class="bullet"><span class="text">WHERE: </span><span class="green">Ben's house</span></div>
    </div>
    <div class="line" id="line4">
      <div class="bullet"><span class="text">WHEN:  </span><span class="yellow">Friday</span></div>
    </div>
    <div class="line" id="line5">
      <div class="bullet"><span class="text">ENDS:  </span><span class="red bold">never. it goes forever.</span></div>
    </div>

    <div class="line" id="line6">&nbsp;</div>

    <div class="line" id="line7">
      <div class="bullet dim"># bring your laptop.</div>
    </div>
    <div class="line" id="line8">
      <div class="bullet dim"># bring your ideas.</div>
    </div>
    <div class="line" id="line9">
      <div class="bullet dim"># we ship at all costs.</div>
    </div>

    <div class="line" id="line10">&nbsp;</div>

    <div class="line" id="line11">
      <div class="user-prompt"><span class="chevron">❯</span>git add yourself</div>
    </div>

    <div class="line" id="line12">
      <div class="bullet"><span class="text">Push the button to confirm your commit.</span><span class="cursor" id="cursor"></span></div>
    </div>

    <!-- Button appears inline after animation -->
    <div class="action-area" id="actionArea">
      <button class="push-btn" id="pushBtn">PUSH TO MAIN</button>
    </div>

    <!-- Post-push output -->
    <div class="line" id="pushOutput" style="display:none; margin-top: 16px;">
      <div class="user-prompt"><span class="chevron">❯</span>git push origin main</div>
    </div>
    <div class="line" id="mergeOutput" style="display:none;">
      <div class="output">
        <div class="tool-block">
          <span class="tool-name">Bash(git push origin main)</span>
          <div class="tool-output" id="mergeDetails"></div>
        </div>
      </div>
    </div>
    <div class="line" id="successOutput" style="display:none;">
      <div class="bullet"><span class="green bold" id="successText"></span></div>
    </div>

    <!-- Git log section -->
    <div class="hacker-log" id="hackerLog" style="margin-top: 24px;">
      <div class="tool-block">
        <span class="tool-name">git log --oneline <span class="dim" id="hackerCount">(0 commits)</span></span>
        <div class="tool-output" id="hackerList">
          <span class="dim">no commits yet</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-label">git config user.name</div>
    <input type="text" id="nameInput" placeholder="enter your name" maxlength="40" autofocus>
    <div class="modal-actions">
      <button class="modal-btn" id="cancelBtn">Cancel</button>
      <button class="modal-btn primary" id="confirmBtn" disabled>Confirm</button>
    </div>
  </div>
</div>

<script>
  const lines = document.querySelectorAll('.line');
  const actionArea = document.getElementById('actionArea');
  const pushBtn = document.getElementById('pushBtn');
  const modalOverlay = document.getElementById('modalOverlay');
  const nameInput = document.getElementById('nameInput');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const hackerList = document.getElementById('hackerList');
  const hackerCount = document.getElementById('hackerCount');

  function randomHash() {
    return Math.random().toString(16).slice(2, 9);
  }

  async function loadHackers() {
    try {
      const res = await fetch('/api/hackers');
      const hackers = await res.json();
      renderHackers(hackers);
    } catch (e) {}
  }

  function renderHackers(hackers) {
    hackerCount.textContent = `(${hackers.length} commit${hackers.length !== 1 ? 's' : ''})`;
    if (hackers.length === 0) {
      hackerList.innerHTML = '<span class="dim">no commits yet</span>';
      return;
    }
    hackerList.innerHTML = hackers
      .map(h => `<div class="hacker-entry"><span class="hash">${randomHash()}</span> add <span class="name">${escapeHtml(h.name)}</span></div>`)
      .join('');
  }

  function escapeHtml(str) {
    const d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  loadHackers();

  // Type out lines
  let currentLine = 0;
  function showNextLine() {
    if (currentLine < lines.length) {
      lines[currentLine].classList.add('visible');
      currentLine++;
      const delay = currentLine <= 1 ? 800 : currentLine === 2 ? 600 : 200;
      setTimeout(showNextLine, delay);
    } else {
      actionArea.classList.add('visible');
    }
  }
  setTimeout(showNextLine, 400);

  pushBtn.addEventListener('click', () => {
    modalOverlay.classList.add('open');
    setTimeout(() => nameInput.focus(), 100);
  });

  cancelBtn.addEventListener('click', () => {
    modalOverlay.classList.remove('open');
  });

  modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) modalOverlay.classList.remove('open');
  });

  nameInput.addEventListener('input', () => {
    confirmBtn.disabled = nameInput.value.trim() === '';
  });

  nameInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && nameInput.value.trim()) confirmBtn.click();
  });

  confirmBtn.addEventListener('click', async () => {
    const name = nameInput.value.trim();
    if (!name) return;

    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Pushing...';

    try {
      await fetch('/api/hackers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name }),
      });
    } catch (e) {}

    modalOverlay.classList.remove('open');
    actionArea.style.display = 'none';

    // Remove cursor
    const cursor = document.getElementById('cursor');
    if (cursor) cursor.remove();

    // Show push output
    const pushOutput = document.getElementById('pushOutput');
    pushOutput.style.display = 'block';

    setTimeout(() => {
      const mergeOutput = document.getElementById('mergeOutput');
      document.getElementById('mergeDetails').innerHTML =
        `Enumerating objects: 3, done.\n` +
        `Writing objects: 100% (3/3), done.\n` +
        `   <span class="yellow">${randomHash()}..${randomHash()}</span>  main → main`;
      mergeOutput.style.display = 'block';

      setTimeout(() => {
        const successOutput = document.getElementById('successOutput');
        document.getElementById('successText').textContent =
          `✓ ${name} merged successfully. see you friday.`;
        successOutput.style.display = 'block';
        loadHackers();
      }, 400);
    }, 600);

    confirmBtn.textContent = 'Confirm';
  });
</script>

</body>
</html>
