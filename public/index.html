<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HACKATHON</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html {
      height: 100%;
    }

    body {
      background: #1e2030;
      min-height: 100%;
      font-family: 'JetBrains Mono', monospace;
      color: #cdd6f4;
      font-size: 14px;
      line-height: 1.6;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .window {
      width: 100%;
      max-width: 1200px;
      height: 85vh;
      background: #282a36;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
    }

    .titlebar {
      background: #3b3e52;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot.r { background: #ed8796; }
    .dot.y { background: #eed49f; }
    .dot.g { background: #a6da95; }

    .titlebar-text {
      color: #6e738d;
      font-size: 13px;
      margin: 0 auto;
    }

    .body {
      padding: 20px 24px 16px;
      overflow-y: auto;
      flex: 1;
    }

    .output { margin-bottom: 16px; }
    .output:last-child { margin-bottom: 0; }

    .user-prompt {
      background: #363a4f;
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 12px;
      color: #cdd6f4;
      font-weight: 700;
    }
    .user-prompt .chevron {
      color: #eed49f;
      margin-right: 6px;
    }

    .bullet {
      padding-left: 20px;
      position: relative;
      margin-bottom: 6px;
    }
    .bullet::before {
      content: '●';
      position: absolute;
      left: 0;
      color: #eed49f;
      font-size: 10px;
      top: 3px;
    }

    .tool-block {
      padding-left: 20px;
      position: relative;
      margin-bottom: 8px;
    }
    .tool-block::before {
      content: '●';
      position: absolute;
      left: 0;
      color: #eed49f;
      font-size: 10px;
      top: 3px;
    }
    .tool-name { color: #cdd6f4; font-weight: 700; }
    .tool-output {
      padding-left: 20px;
      color: #939ab7;
      border-left: 1px solid #494d64;
      margin-top: 4px;
      margin-left: 2px;
    }

    .dim { color: #6e738d; }
    .green { color: #a6da95; }
    .red { color: #ed8796; }
    .yellow { color: #eed49f; }
    .blue { color: #8aadf4; }
    .mauve { color: #c6a0f6; }
    .bold { font-weight: 700; }
    .text { color: #cdd6f4; }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 14px;
      background: #cdd6f4;
      vertical-align: text-bottom;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }

    .line { display: none; }
    .line.visible { display: block; }

    /* Thinking spinner */
    .thinking {
      display: none;
      padding-left: 20px;
      color: #c6a0f6;
      font-size: 13px;
      margin-bottom: 6px;
    }
    .thinking.visible { display: flex; align-items: center; gap: 8px; }
    .thinking .spinner {
      display: inline-block;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { content: '⠋'; }
      100% { transform: rotate(360deg); }
    }
    .thinking .dot-spinner::after {
      content: '';
      animation: dots 1.5s steps(4) infinite;
    }
    @keyframes dots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
    }

    /* Inline terminal input */
    .prompt-input-area {
      display: none;
      margin-top: 16px;
    }
    .prompt-input-area.visible { display: block; }

    .prompt-input-row {
      display: flex;
      align-items: center;
      background: #363a4f;
      border-radius: 4px;
      padding: 6px 10px;
      gap: 6px;
    }

    .prompt-input-row .chevron {
      color: #eed49f;
      font-weight: 700;
      flex-shrink: 0;
    }

    .prompt-input-row .prefix {
      color: #cdd6f4;
      font-weight: 700;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .prompt-input-row input {
      background: none;
      border: none;
      outline: none;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: #a6da95;
      flex: 1;
      min-width: 0;
      caret-color: #cdd6f4;
    }
    .prompt-input-row input::placeholder {
      color: #494d64;
    }

    .prompt-hint {
      color: #494d64;
      font-size: 12px;
      margin-top: 6px;
      padding-left: 4px;
    }

    /* Committed hackers as git log output */
    .hacker-log { margin-top: 16px; }
    .hacker-entry {
      padding-left: 20px;
      color: #939ab7;
    }
    .hacker-entry .hash { color: #eed49f; }
    .hacker-entry .name { color: #a6da95; }

    /* Status bar */
    .statusbar {
      background: #363a4f;
      padding: 6px 16px;
      font-size: 12px;
      color: #6e738d;
      display: flex;
      flex-direction: column;
      gap: 2px;
      flex-shrink: 0;
      border-top: 1px solid #494d64;
    }
    .statusbar .status-top {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .statusbar .status-top span { white-space: nowrap; }
    .statusbar .sep { color: #494d64; }
    .statusbar .status-bottom {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .statusbar .arrows { color: #a6da95; }
    .statusbar .perms { color: #a6da95; font-weight: 700; }
    .statusbar .cycle { color: #6e738d; }

    @media (max-width: 600px) {
      html { font-size: 12px; }
      .body { padding: 16px; }
      .window { width: 95%; max-height: 95vh; }
    }
  </style>
</head>
<body>

<div class="window">
  <div class="titlebar">
    <div class="dot r"></div>
    <div class="dot y"></div>
    <div class="dot g"></div>
    <span class="titlebar-text">hackathon — bash</span>
  </div>

  <div class="body" id="terminal">

    <div class="line" id="line0">
      <div class="user-prompt"><span class="chevron">❯</span>cat hackathon.env</div>
    </div>

    <div class="thinking" id="thinking">
      <span class="mauve">· Canoodling<span class="dot-spinner"></span></span>
    </div>

    <div class="line" id="line1">
      <div class="output">
        <div class="tool-block">
          <span class="tool-name">Read(hackathon.env)</span>
          <div class="tool-output">
            <span class="dim">1</span> <span class="green">EVENT</span>=<span class="yellow">"HACKATHON"</span><br>
            <span class="dim">2</span> <span class="green">LOCATION</span>=<span class="yellow">"Ben's house"</span><br>
            <span class="dim">3</span> <span class="green">START</span>=<span class="yellow">"Friday"</span><br>
            <span class="dim">4</span> <span class="green">END</span>=<span class="yellow">"never"</span><br>
            <span class="dim">5</span><br>
            <span class="dim">6</span> <span class="dim"># bring your laptop.</span><br>
            <span class="dim">7</span> <span class="dim"># bring your ideas.</span><br>
            <span class="dim">8</span> <span class="dim"># we ship at all costs.</span>
          </div>
        </div>
      </div>
    </div>

    <div class="line" id="line2">
      <div class="bullet">You're invited. It starts <span class="yellow">Friday</span> and goes <span class="red bold">forever</span>.</div>
    </div>

    <div class="line" id="line3">&nbsp;</div>

    <div class="line" id="line4">
      <div class="bullet">Enter your name below and hit <span class="yellow">enter</span> to push to main.<span class="cursor" id="cursor"></span></div>
    </div>

    <!-- Inline terminal prompt input -->
    <div class="prompt-input-area" id="inputArea">
      <div class="prompt-input-row">
        <span class="chevron">❯</span>
        <span class="prefix">git commit --author="</span>
        <input type="text" id="nameInput" placeholder="your name" maxlength="40" autofocus>
        <span class="prefix">"</span>
      </div>
      <div class="prompt-hint">press enter to push to main</div>
    </div>

    <!-- Post-push output -->
    <div class="line" id="pushOutput" style="display:none; margin-top: 16px;">
      <div class="user-prompt"><span class="chevron">❯</span>git push origin main</div>
    </div>
    <div class="line" id="mergeOutput" style="display:none;">
      <div class="output">
        <div class="tool-block">
          <span class="tool-name">Bash(git push origin main)</span>
          <div class="tool-output" id="mergeDetails"></div>
        </div>
      </div>
    </div>
    <div class="line" id="successOutput" style="display:none;">
      <div class="bullet"><span class="green bold" id="successText"></span></div>
    </div>

    <!-- Git log section -->
    <div class="hacker-log" id="hackerLog" style="margin-top: 24px;">
      <div class="tool-block">
        <span class="tool-name">git log --oneline <span class="dim" id="hackerCount">(0 commits)</span></span>
        <div class="tool-output" id="hackerList">
          <span class="dim">no commits yet</span>
        </div>
      </div>
    </div>

  </div>

  <div class="statusbar">
  <div class="status-top">
    <span>~/hackathon-invite</span>
    <span class="sep">|</span>
    <span>[Opus 4.5]</span>
    <span class="sep">|</span>
    <span>Ctx: 1% ◑</span>
    <span class="sep">|</span>
    <span>git:main (clean)</span>
  </div>
  <div class="status-bottom">
    <span class="arrows">▸▸</span>
    <span class="perms">bypass permissions on</span>
    <span class="cycle">(shift+tab to cycle)</span>
  </div>
  </div>
</div>

<script>
  const lines = document.querySelectorAll('.line');
  const inputArea = document.getElementById('inputArea');
  const nameInput = document.getElementById('nameInput');
  const hackerList = document.getElementById('hackerList');
  const hackerCount = document.getElementById('hackerCount');

  function randomHash() {
    return Math.random().toString(16).slice(2, 9);
  }

  async function loadHackers() {
    try {
      const res = await fetch('/api/hackers');
      const hackers = await res.json();
      renderHackers(hackers);
    } catch (e) {}
  }

  function renderHackers(hackers) {
    hackerCount.textContent = `(${hackers.length} commit${hackers.length !== 1 ? 's' : ''})`;
    if (hackers.length === 0) {
      hackerList.innerHTML = '<span class="dim">no commits yet</span>';
      return;
    }
    hackerList.innerHTML = hackers
      .map(h => `<div class="hacker-entry"><span class="hash">${randomHash()}</span> add <span class="name">${escapeHtml(h.name)}</span></div>`)
      .join('');
  }

  function escapeHtml(str) {
    const d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  loadHackers();

  const thinking = document.getElementById('thinking');

  const verbs = ['Canoodling', 'Brewing', 'Warping', 'Churning', 'Vibing', 'Cooking'];

  // Type out lines with thinking spinner
  let currentLine = 0;
  function showNextLine() {
    if (currentLine < lines.length) {
      if (currentLine === 0) {
        // Show first prompt immediately
        lines[currentLine].classList.add('visible');
        currentLine++;
        // Show thinking spinner
        thinking.classList.add('visible');
        const verb = verbs[Math.floor(Math.random() * verbs.length)];
        thinking.innerHTML = `<span class="mauve">· ${verb}<span class="dot-spinner"></span></span>`;
        setTimeout(showNextLine, 2500);
      } else if (currentLine === 1) {
        // Hide thinking, show content
        thinking.classList.remove('visible');
        lines[currentLine].classList.add('visible');
        currentLine++;
        setTimeout(showNextLine, 400);
      } else {
        lines[currentLine].classList.add('visible');
        currentLine++;
        setTimeout(showNextLine, 300);
      }
    } else {
      inputArea.classList.add('visible');
      setTimeout(() => nameInput.focus(), 100);
    }
  }
  setTimeout(showNextLine, 400);

  // Submit on enter
  nameInput.addEventListener('keydown', async (e) => {
    if (e.key !== 'Enter') return;
    const name = nameInput.value.trim();
    if (!name) return;

    // Freeze the input
    nameInput.disabled = true;

    try {
      await fetch('/api/hackers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name }),
      });
    } catch (e) {}

    // Remove cursor
    const cursor = document.getElementById('cursor');
    if (cursor) cursor.remove();

    // Hide input hint
    inputArea.querySelector('.prompt-hint').style.display = 'none';

    // Show push output
    const pushOutput = document.getElementById('pushOutput');
    pushOutput.style.display = 'block';

    setTimeout(() => {
      const mergeOutput = document.getElementById('mergeOutput');
      document.getElementById('mergeDetails').innerHTML =
        `Enumerating objects: 3, done.\n` +
        `Writing objects: 100% (3/3), done.\n` +
        `   <span class="yellow">${randomHash()}..${randomHash()}</span>  main → main`;
      mergeOutput.style.display = 'block';

      setTimeout(() => {
        const successOutput = document.getElementById('successOutput');
        document.getElementById('successText').textContent =
          `✓ ${name} merged successfully. see you friday.`;
        successOutput.style.display = 'block';
        loadHackers();
      }, 400);
    }, 600);
  });
</script>

</body>
</html>
